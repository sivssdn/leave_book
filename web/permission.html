<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Permit </title>
</head>
<body>

    <!--on input start suggesting, on keydown fill in the student id and image-->

    Name : <input type="text" id="name" name="name" list="names" oninput="getName()" onkeydown="displayStudentData(event)" autocomplete="off"> <br>
    <datalist id="names">
    </datalist>

    <form method="get" action="controller.jsp">

    Student id : <input type="text" name="student_id" id="student_id"> <br>
    Date out : <input type="date" name="date_out" ><br>
    Time out : <input type="time" name="time_out"><br>
    Date in : <input type="date" name="date_in" ><br>
    Time in : <input type="time" name="time_in"><br>
    <input type="submit" name="permission" value="submit">
    </form>

    <img src="" id="student_image" height="200" width="100" >
</body>

<script>
    var xhr = null;
    var images=[];
    var studentIds=[];
    function getName() {
        try {
            xhr = new XMLHttpRequest();
        } catch (e) {
            xhr = new ActiveXObject("Microsoft.XMLHTTP");
        }
        if (xhr == null)
            alert("Ajax not supported");

        //  if(document.getElementById("type").nodeValue=="id")
        if(document.getElementById("name").value!=undefined)

        var url = "controller.jsp?autocomplete=1&search_field=" + document.getElementById("name").value + "&search_type=name";
        //alert(document.getElementById("value").value);

        xhr.onreadystatechange = handler;
        xhr.open("GET", url, true);
        xhr.send(null);

    }
    function handler() {
        if (xhr.readyState == 4) {
            if (xhr.status == 200) {
                //var response=eval("("+ xhr.responseText +")");//converting to an object ::JSON
                 images=[];
                 studentIds=[];
                //var text=document.createTextNode("Appended :"+JSON.parse(xhr.response));
                    //loop over array
                var names=document.getElementById("names");
                var option;
                    //removing all the previous elements
                    while (names.firstChild)
                        names.removeChild(names.firstChild);

                var details = JSON.parse(xhr.responseText);
                for (var i = 0; i < details.length; i++) {

                    option=document.createElement('option');
                    option.text=details[i].name;
                    option.value=details[i].name;
                    option.id=i;
                    images[details[i].name]=details[i].image;
                    studentIds[details[i].name]=details[i].id;
                   // document.getElementById("student_id").value=details[i].id;
                   // document.getElementById("student_image").src="\\images\\"+details[i].image+".jpg";
                    //option.addEventListener("click",displayStudentData(id),false);
                    //option.onclick=displayStudentData(id);

                    names.appendChild(option);
                }


                //div.appendChild(text);
                //document.getElementById("cr").appendChild(div);
            }
        }
    }

    //for filling up student id and image
    function displayStudentData(e){
        if(e.which == 13) //enter pressed in chrome
        {
            clearNames();
            document.getElementById("student_image").src="\\images\\"+images[document.getElementById("name").value]+".jpg";
            document.getElementById("student_id").value=studentIds[document.getElementById("name").value];
        }
        return false;
        /*
        document.getElementById("student_id").value=studentIds[id];
        document.getElementById("student_image").src="\\images\\"+images[id]+".jpg";
        return false;
        */
    }


    //to delete all items from names datalist
    function clearNames() {
        var names=document.getElementById("names");
        while(names.firstChild)
        names.removeChild(names.firstChild);
    }
</script>


</html>